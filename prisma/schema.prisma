// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Patient {
  id             String          @id @default(cuid())
  name           String
  sex            String
  birthDate      DateTime
  heightM        Float
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  assessments    Assessment[]
  clinicalIntake ClinicalIntake?
}

model ClinicalIntake {
  id                    String   @id @default(cuid())
  patientId             String   @unique
  patient               Patient  @relation(fields: [patientId], references: [id])

  // Main complaint and goals
  mainComplaint         String?
  goals                 String?  // JSON array: ["emagrecimento", "hipertrofia", "performance", "longevidade", "saude_geral"]

  // Comorbidities (boolean flags)
  hasHypertension       Boolean  @default(false)
  hasDiabetes           Boolean  @default(false)
  hasPrediabetes        Boolean  @default(false)
  hasDyslipidemia       Boolean  @default(false)
  hasSteatosis          Boolean  @default(false)
  hasThyroidDisorder    Boolean  @default(false)
  otherComorbidities    String?

  // Family history
  familyHistoryCV       Boolean  @default(false)  // IAM/AVC precoce
  familyHistoryDM       Boolean  @default(false)
  familyHistoryObesity  Boolean  @default(false)
  familyHistoryNotes    String?

  // Lifestyle habits
  sleepHoursAvg         Float?
  sleepQuality          String?  // "ruim", "regular", "boa", "excelente"
  isSmoker              Boolean  @default(false)
  smokingDetails        String?
  alcoholFrequency      String?  // "nunca", "raramente", "social", "frequente", "diario"
  physicalActivityLevel String?  // "sedentario", "leve", "moderado", "intenso", "atleta"
  physicalActivityType  String?
  ultraProcessedFreq    String?  // "nunca", "raramente", "semanal", "diario"
  waterIntakeLiters     Float?

  // Relevant symptoms (for RED-S and other risks)
  hasFatigue            Boolean  @default(false)
  hasPerformanceDrop    Boolean  @default(false)
  hasAmenorrhea         Boolean  @default(false)
  hasStressFractures    Boolean  @default(false)
  hasFrequentInfections Boolean  @default(false)
  hasDigestiveIssues    Boolean  @default(false)
  hasMoodChanges        Boolean  @default(false)
  otherSymptoms         String?

  // Medications and supplements
  currentMedications    String?
  currentSupplements    String?

  // Additional notes
  notes                 String?

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

model Assessment {
  id               String    @id @default(cuid())
  patientId        String
  patient          Patient   @relation(fields: [patientId], references: [id])
  dateTime         DateTime  @default(now())
  weightKg         Float?
  bfPercent        Float?
  waistCm          Float?
  hipCm            Float?
  neckCm           Float?
  skeletalMuscleKg Float?
  ffmKg            Float?
  visceralFatIndex Float?
  tbwL             Float?
  ecwL             Float?
  icwL             Float?
  phaseAngleDeg    Float?
  activityLevel    String?
  estimatedIntakeKcal Float?
  exerciseEnergyExpenditureKcal Float?
  proteinMassKg    Float?
  mineralMassKg    Float?
  // Skinfold measurements (mm)
  tricepsMm        Float?
  subscapularMm    Float?
  suprailiacMm     Float?
  abdominalMm      Float?
  thighMm          Float?
  chestMm          Float?
  midaxillaryMm    Float?
  skinfoldProtocol String?
  skinfoldNotes    String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  metrics          Metrics?
}

model Metrics {
  id                       String     @id @default(cuid())
  assessmentId             String     @unique
  assessment               Assessment @relation(fields: [assessmentId], references: [id])
  bmi                      Float?
  bmiCategory              String?
  waistHeightRatio         Float?
  waistHeightRisk          String?
  waistHipRatio            Float?
  waistHipRisk             String?
  fatMassKg                Float?
  leanMassKg               Float?
  smi                      Float?
  bmrMifflin               Float?
  bmrCunningham            Float?
  tdee                     Float?
  energyAvailability       Float?
  eaCategory               String?
  ecwTbwRatio              Float?
  cardiometabolicScore     Int?
  cardiometabolicRiskLevel String?
  redsScore                Int?
  redsRiskLevel            String?
  metabolicAgeYears        Int?
  ffmi                     Float?
  fmi                      Float?
  smmWeightRatio           Float?
  bcmKg                    Float?
  bodyCompScore            Int?
  // Skinfold-derived metrics
  bodyDensity              Float?
  bfPercentSkinfold        Float?
  bfPercentMethod          String?
  createdAt                DateTime   @default(now())
  updatedAt                DateTime   @updatedAt
}
